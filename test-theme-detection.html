<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Detection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .test-result {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .keyword-tag {
            background: #2196F3;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
        }
        h1 { color: #333; }
        h2 { color: #666; font-size: 18px; }
    </style>
</head>
<body>
    <h1>ðŸŽµ Theme Detection Test Suite</h1>
    <p>Testing the enhanced contextual theme detection system with 65+ themes</p>
    
    <div id="test-results"></div>

    <script type="module">
        import { MoodProcessor } from './js/core/mood-processor.js';

        const processor = new MoodProcessor();
        const testCases = [
            {
                title: "Viking Adventure",
                content: "The viking longship sailed across the fjord. Odin's warriors prepared for the raid. The shield wall formed as the berserker charged into battle.",
                expected: ["viking", "battle", "nautical"]
            },
            {
                title: "Samurai Honor",
                content: "The samurai drew his katana in the temple garden. Cherry blossoms fell as he meditated on bushido and honor. The shogun's decree echoed through the pagoda.",
                expected: ["eastern", "mystical", "royal"]
            },
            {
                title: "Victorian Mystery",
                content: "The detective walked through gaslit streets of London. The factory chimney loomed over the manor. A gentleman in a top hat entered the parlor.",
                expected: ["victorian", "noir", "urban"]
            },
            {
                title: "Pirate Treasure",
                content: "The pirate captain stood on deck as the ship sailed toward the Caribbean island. The crew muttered about treasure and gold doubloons buried in a chest.",
                expected: ["pirate", "nautical", "adventure"]
            },
            {
                title: "Space Opera",
                content: "The spaceship drifted through the galaxy. Aliens contacted the astronaut near a distant nebula. The hologram displayed coordinates to a black hole.",
                expected: ["cosmic", "future", "sci-fi"]
            },
            {
                title: "Medieval Quest",
                content: "The knight rode to the castle for the tournament. His armor gleamed as he prepared to joust. The monastery bells rang across the feudal lands.",
                expected: ["medieval", "royal", "choral"]
            },
            {
                title: "Jazz Age Detective",
                content: "The speakeasy buzzed with jazz music. The flapper danced as the detective investigated the case in 1920s Chicago. Prohibition agents raided the nightclub.",
                expected: ["jazz-age", "jazz", "noir"]
            },
            {
                title: "Haunted Manor",
                content: "Ghosts haunted the old mansion. Spirits and phantoms moved through shadows. The curse possessed the house, and an exorcism was needed.",
                expected: ["haunted", "mystical", "victorian"]
            },
            {
                title: "Indian Palace",
                content: "The maharaja ruled from his palace in Delhi. Sitar music played as dancers performed. The temple overlooked the Ganges river.",
                expected: ["indian", "royal", "eastern"]
            },
            {
                title: "Apocalypse Survival",
                content: "Survivors wandered the wasteland after the apocalypse. The ruins of civilization crumbled. Radiation filled the air in the post-apocalyptic world.",
                expected: ["apocalyptic", "future", "wilderness"]
            }
        ];

        const resultsDiv = document.getElementById('test-results');

        testCases.forEach((testCase, index) => {
            const combinedText = `${testCase.title} ${testCase.content}`.toLowerCase();
            const detectedThemes = processor._detectContextualThemes(combinedText);
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            
            const matches = detectedThemes.filter(theme => 
                testCase.expected.some(exp => exp === theme)
            );
            const accuracy = matches.length / testCase.expected.length * 100;
            
            testDiv.innerHTML = `
                <h2>Test ${index + 1}: ${testCase.title}</h2>
                <div class="test-input">
                    <strong>Content:</strong> ${testCase.content.substring(0, 150)}...
                </div>
                <div class="test-result">
                    <strong>Expected Themes:</strong>
                    <div class="keywords">
                        ${testCase.expected.map(kw => `<span class="keyword-tag">${kw}</span>`).join('')}
                    </div>
                    <strong>Detected Themes:</strong>
                    <div class="keywords">
                        ${detectedThemes.map(kw => `<span class="keyword-tag" style="background: ${testCase.expected.includes(kw) ? '#4CAF50' : '#FF9800'}">${kw}</span>`).join('')}
                    </div>
                    <strong>Accuracy:</strong> ${accuracy.toFixed(0)}% (${matches.length}/${testCase.expected.length} matched)
                </div>
            `;
            
            resultsDiv.appendChild(testDiv);
        });

        // Summary
        const summary = document.createElement('div');
        summary.className = 'test-case';
        summary.innerHTML = `
            <h2>âœ… Test Summary</h2>
            <p><strong>Total Tests:</strong> ${testCases.length}</p>
            <p><strong>Theme Categories:</strong> 65+</p>
            <p><strong>Detection Method:</strong> Frequency-based scoring with contextual keywords</p>
            <p>Green tags = Correctly detected | Orange tags = Extra detections (not necessarily wrong)</p>
        `;
        resultsDiv.appendChild(summary);
    </script>
</body>
</html>
